{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>График платежей репетитора</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-chalkboard-teacher"></i>
                <h1>График платежей</h1>
            </div>
            <!-- <div class="filters">
                <button class="filter-btn active">
                    <i class="fas fa-list"></i> Все ученики
                </button>
                <button class="filter-btn">
                    <i class="fas fa-check-circle"></i> Оплатившие
                </button>
                <button class="filter-btn">
                    <i class="fas fa-clock"></i> Ожидающие
                </button>
                <button class="filter-btn">
                    <i class="fas fa-times-circle"></i> Не оплатившие
                </button>
            </div> -->
        </header>
        
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon primary">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ total_students }}</h3>
                    <p>Всего учеников</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon warning">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ total_income }} руб.</h3>
                    <p>Общий доход за {{ now_year }} год</p>
                </div>
            </div>
        </div>
        <form method="post" action="/bot/payment-info/" class="filter-form" id="monthFilterForm">
            {% csrf_token %}
            <label for="course">Фильтр по классу:</label>
            <select name="course" id="course" class="month-select">
                <option value="*">Все</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
            </select>
            <button type="submit" class="filter-btn">
                <i class="fas fa-filter"></i> Применить фильтр
            </button>
        </form>
        <div class="months-container">
            {% for year in all_info %}
                {% for month in year.months %}
                <div class="month-card">
                    <div class="month-header" onclick="toggleMonth('month-{{ forloop.counter }}', this)">
                        <div class="month-title">{{ month.title }} {{ year.date }}</div>
                        <div class="month-stats">
                            <div class="month-stat">Учеников: {{ month.all_users }}</div>
                            <div class="month-stat">Оплатили: {{ month.payers_count }}</div>
                            <div class="month-stat">
                                <i class="fas fa-chevron-down collapse-icon"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div id="month-{{ forloop.counter }}" class="month-content">
                        {% for student in month.paid_users %}
                        <div class="student-card">
                            <div class="student-header status-paid">
                                <div class="student-name">{{ student.student_profile.profile_name }}</div>
                                <div class="payment-status">
                                    Оплачено
                                </div>
                            </div>
                            <div class="student-details">
                                <div class="detail-row">
                                    <span class="detail-label">Класс:</span>
                                    <span class="detail-value">{{ student.student_profile.course_or_class }}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Стоимость:</span>
                                    <span class="detail-value">{{ student.amount_paid }} руб.</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% for student in month.unpaid_users %}
                        <div class="student-card">
                            <div class="student-header status-unpaid">
                                <div class="student-name">{{ student.profile_name }}</div>
                                <div class="payment-status">
                                    Не оплачено
                                </div>
                            </div>
                            <div class="student-details">
                                <div class="detail-row">
                                    <span class="detail-label">Класс:</span>
                                    <span class="detail-value">{{ student.course_or_class }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            {% endfor %}
        </div>
    </div>

    <script src="{% static 'js/script.js' %}">
    </script>
</body>
</html>